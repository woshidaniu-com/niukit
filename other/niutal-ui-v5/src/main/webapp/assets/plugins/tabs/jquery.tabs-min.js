(function($){$.bootui=$.bootui||{};$.bootui.widget=$.bootui.widget||{};$.bootui.widget.Tabs=function(element,options){options.beforeRender.call(this,element);try{this.initialize.call(this,element,options)}catch(e){options.errorRender.call(this,e)}options.afterRender.call(this,element)};$.bootui.widget.Tabs.prototype={constructor:$.bootui.widget.Tabs,initialize:function(element,options){var $this=this;var skin;function getUID(prefix){do{prefix+=~~(Math.random()*1000000)}while(document.getElementById(prefix));return prefix}var tabs_uid=getUID(options.prefix);var iframeHeight=$.isFunction(options.iframeHeight)?options.iframeHeight.call(this):options.iframeHeight;var templates={container:function(){var html=[];html.push('<div class="nav-container">');html.push("<!-- Nav tabs -->");html.push('<ul class="nav nav-tabs" role="tablist">');html.push('<li role="presentation" class="active">');html.push('<a href="#home" aria-controls="home" role="tab" data-toggle="tab">');html.push('<span class="fa fa-fw fa-home fa-sm" aria-hidden="true"></span>');html.push("主页");html.push("</a>");html.push("</li>");html.push("</ul>");html.push("<!-- Tab panes -->");html.push('<div class="tab-content">');html.push('<div role="tabpanel" class="tab-pane active" id="tab_home">');html.push("</div>");html.push("</div>");html.push("</div>");return html.join("")},tabtitle:function(opts){var id="tab_"+opts.id;var title=$("<li>",{"role":"presentation","id":"tab_"+id}).append($("<a>",{"href":"#"+id,"aria-controls":id,"role":"tab","data-toggle":"tab","aria-url":opts.url,"class":"button button--ujarak button--border-thin button--text-thick"}).append(opts.icon?$("<i>",{"class":opts.icon}):"").append($("<span>",{}).html(opts.title)));if(options.closeable){var html="";html+='<div class="close-tab-content">';html+="</div>";title.find("a").after(html)}return title},tabpanel:function(opts){var id="tab_"+opts.id;var content=$("<div>",{"class":"tab-pane","id":id,"role":"tabpanel"});if(opts.content){content.append(opts.content)}else{if(options.iframeUse&&!opts.ajax){content.append('<iframe id="iframe_'+id+'" class="iframeClass embed-responsive-item" height="'+iframeHeight+'" src="'+newURL(opts,true)+'" style="height:'+iframeHeight+'px" />')}else{$.get(opts.url,function(data){content.append(data)})}}return content},tabdrop:function(){var html=[];html.push('<li class="dropdown pull-right tabdrop no-sort" id="tabs_dropdown">');html.push('<a href="javascript:void(0);" data-toggle="dropdown" class="dropdown-toggle">');html.push('<i class="glyphicon glyphicon-align-justify"></i>');html.push('<b class="caret"></b>');html.push("</a>");html.push('<ul class="dropdown-menu"></ul>');html.push("</li>");return html.join("");var dropdown=$("<li>",{"class":"dropdown pull-right hide tabdrop"}).append($("<a>",{"class":"dropdown-toggle","data-toggle":"dropdown","href":"javascript:void(0);"}).append($("<i>",{"class":"glyphicon glyphicon-align-justify"})).append($("<b>",{"class":"caret"}))).append($("<ul>",{"class":"dropdown-menu"}))},shrinkPageSize:function(){var html=[];html.push('<div class="shrink-title">');html.push('<span class="title"></span>');html.push('<i class="glyphicon glyphicon-resize-small"></i>');html.push("</div>");return html.join("")}};$(options.monitor).off("click","[data-addtab]").on("click","[data-addtab]",function(){$this.builTab({id:$(this).data("addtab"),title:$(this).attr("title")?$(this).attr("title"):$(this).html(),content:options.content?options.content:$(this).attr("content"),url:$(this).data("src"),ajax:$(this).attr("ajax")?true:false,tablayout:$(this).data("tab-layout"),funclayout:$(this).data("blank-layout"),data:$(this).data("request")||{},icon:$(this).data("icon")})});if(options.contextmenu){$(element).on("contextmenu","li[role=presentation]",function(event){var id=$(this).children("a").attr("aria-controls");if(id&&id!="home"){$this.pop(id,$(this),event)}return false});$(element).on("click","ul.rightMenu a[data-right=refresh]",function(){var id=$(this).parent("ul").attr("aria-controls").substring(4);var url=$(this).parent("ul").attr("aria-url");$this.builTab({"id":id,"url":url,"refresh":true});$("#popMenu").fadeOut()});$(element).on("click","ul.rightMenu a[data-right=remove]",function(){var id=$(this).parent("ul").attr("aria-controls");if(id.substring(0,4)!="tab_"){return}$this.close(id);$this.drop();$("#popMenu").fadeOut()});$(element).on("click","ul.rightMenu a[data-right=remove-circle]",function(){var tab_id=$(this).parent("ul").attr("aria-controls");$(element).find("ul.nav").find("li").each(function(){var id=$(this).attr("id");if(id&&id!="tab_"+tab_id){$this.close($(this).children("a").attr("aria-controls"))}});$this.drop();$("#popMenu").fadeOut()});$(element).on("click","ul.rightMenu a[data-right=remove-left]",function(){var tab_id=$(this).parent("ul").attr("aria-controls");$("#tab_"+tab_id).prevUntil().each(function(){var id=$(this).attr("id");if(id&&id!="tab_"+tab_id){$this.close($(this).children("a").attr("aria-controls"))}});$this.drop();
$("#popMenu").fadeOut()});$(element).on("click","ul.rightMenu a[data-right=remove-right]",function(){var tab_id=$(this).parent("ul").attr("aria-controls");$("#tab_"+tab_id).nextUntil().each(function(){var id=$(this).attr("id");if(id&&id!="tab_"+tab_id){$this.close($(this).children("a").attr("aria-controls"))}});$this.drop();$("#popMenu").fadeOut()})}$(element).off("click",".close-tab-content").on("click",".close-tab-content",function(){var id=$(this).prev("a").attr("aria-controls");$this.close(id)}).off("mouseover","li:not("+options.selector+" li.dropdown)").on("mouseover","li:not("+options.selector+" li.dropdown)",function(){$(this).find(".close-tab").show()}).off("mouseleave","li").on("mouseleave","li",function(){$(this).find(".close-tab").hide()}).off("click",".tabdrop li a").on("click",".tabdrop li a",function(){var $prev=$(".tabdrop").prev();$(".tabdrop").find(".dropdown-menu").append($prev);$("#tab_tab_home").after($(this).closest("li"))});$(document).off("click","#tab_tab_home").on("click","#tab_tab_home",function(){$(".tab-pane").removeClass("active");$("#tab_home").addClass("active")});$(window).resize(function(){var paneHeight=$(window).height()-$("#tabs").outerHeight(true)-$("#footer").outerHeight(true)-$("#navbar").outerHeight(true);iframeHeight=paneHeight;$("#tab-general .tab-pane").css("height",paneHeight+"px");var iframes=document.getElementsByTagName("iframe");for(var i=0;i<iframes.length;i++){$("#"+iframes[i].id).height(iframeHeight);$("#"+iframes[i].id).css({"min-height":"300px"})}$this.drop()});var container=$(element).find("div.nav-container");if(container.size()==0){container=$(templates.container());$(element).empty().append(container)}$(container).attr("id",tabs_uid);function newURL(opts,isTab){var url=opts.url;var parmas=[];$.each($.extend(opts.data||{},{"layout":(isTab?opts.tablayout:(opts.funclayout||"func-layout"))}),function(key,val){if($.isArray(val)){$.each(val,function(i,item){parmas.push(key+"="+val)})}else{if($.isFunction(val)){parmas.push(key+"="+val.call(this))}else{parmas.push(key+"="+val)}}});parmas.push("_t="+jQuery.now());parmas.push("skin="+skin);return url.indexOf("?")>-1?(url+"&"+parmas.join("&")):(url+"?"+parmas.join("&"))}$.extend(true,$this,{destroy:function(){$(element).off("."+options.prefix).removeData("bootui.tabs");$("#"+tabs_uid).remove()},builTab:function(opts){var id="tab_"+opts.id;var url=opts.url;$('li[role="presentation"].active').removeClass("active");$('div[role="tabpanel"].active').removeClass("active");if(!$("#"+id).length){var title=$(templates.tabtitle(opts));title.data("opts",opts);title.dblclick(function(){var opts=$(this).data("opts");window.open(newURL(opts,false))});var str=title.find("a").attr("aria-controls");var _id=str.slice(4);addOpenedMark();title.click(function(){addOpenedMark()});function addOpenedMark(){$(".zf-left-nav-panel").find("a").each(function(){var addtab=$(this).attr("data-addtab");if(addtab==_id){$(".current-root-mark").removeClass("current-root-mark");$(".current-mark").removeClass("current-mark");$(this).closest(".left-nav-root").find(">a").addClass("current-root-mark");$(this).addClass("current-mark");$(".current-mark").closest("ul").parent("li").addClass("active")}})}var content=$(templates.tabpanel(opts));$(element).find(".nav-tabs").find("#tab_tab_home").after(title);$("body").find("#tab-general>.tab-content").prepend(content);$(".nav-tabs").show();$("#tab_"+id).addClass("active");$("#"+id).addClass("active");$this.drop()}else{if(!opts.refresh){$("#tab_"+id).addClass("active");$("#"+id).addClass("active");if($("#tab_"+id).closest("ul").hasClass("dropdown-menu")){var $prev=$(".tabdrop").prev();$(".tabdrop").find(".dropdown-menu").append($prev);$("#tab_tab_home").after($("#tab_"+id).closest("li"))}return}else{var content=$("#"+id);content.html("")}}if(options.sortable&&$.fn.sortable){$('ul[role="tablist"]').sortable({axis:"x",cancel:".no-sort",distance:20,items:"> li:not('#tab_tab_home,#tabs_dropdown')"});$('ul[role="tablist"]').disableSelection()}$(".zf-home-page").hide();$("#tab-general").show()},pop:function(id,e){$("body").find("#popMenu").remove();var popHtml=$("<ul>",{"aria-controls":id,"class":"rightMenu list-group",id:"popMenu","aria-url":e.find(">a").attr("aria-url"),}).css("width","150px").append('<a href="javascript:void(0);" class="list-group-item" data-right="remove"><i class="glyphicon glyphicon-remove"></i> 关闭此标签</a>'+'<a href="javascript:void(0);" class="list-group-item" data-right="remove-circle"><i class="glyphicon glyphicon-remove-circle"></i> 关闭其他标签</a>'+'<a href="javascript:void(0);" class="list-group-item" data-right="remove-left"><i class="glyphicon glyphicon-chevron-left"></i> 关闭左侧标签</a>'+'<a href="javascript:void(0);" class="list-group-item" data-right="remove-right"><i class="glyphicon glyphicon-chevron-right"></i> 关闭右侧标签</a>');var left=event.pageX-10;var top=event.pageY-10;if(top+popHtml.height()>=$(window).height()){top-=popHtml.height()}if(left+popHtml.width()>=$(window).width()){left-=popHtml.width()
}popHtml.css({zIndex:1000001,left:left,top:top,position:"absolute"});popHtml.appendTo($(element)).fadeIn();popHtml.mouseleave(function(){popHtml.hide()})},close:function(id){if($(element).find("li.active").attr("id")=="tab_"+id){$("#tab_"+id).prev().addClass("active");$("#"+id).prev().addClass("active")}$(".left-nav-root").removeClass("active");if($("#tab_tab_home").hasClass("active")){$("#tab_home").addClass("active")}var el=document.getElementById("iframe_"+id);if(el){var iframe=el.contentWindow;el.src="about:blank";try{iframe.document.write("");iframe.document.clear()}catch(e){}try{document.body.removeChild(el)}catch(e){}}$("#tab_"+id).remove();$("#"+id).remove();$this.drop();options.callback()},closeAll:function(){$.each($(element).find("li[id]"),function(){var id=$(this).children("a").attr("aria-controls");$("#tab_"+id).remove();$("#"+id).remove()});$(element).find('li[role = "presentation"]').first().addClass("active");var firstID=$(element).find('li[role = "presentation"]').first().children("a").attr("aria-controls");$("#"+firstID).addClass("active");$this.drop()},drop:function(){var tabs=$(element).find(".nav-tabs");var dropdown=$(templates.tabdrop());if(tabs.find(".tabdrop").size()==0){dropdown.appendTo(tabs)}else{dropdown=tabs.find(".tabdrop")}var collection=0;tabs.append(dropdown.find("li")).find(">li").not(".tabdrop").each(function(){if(this.offsetTop>0||tabs.width()-$(this).position().left-$(this).width()<130&&tabs.find(">li").size()>2){dropdown.find("ul").prepend($(this));collection++}});if(collection>0){dropdown.removeClass("hide");if(dropdown.find(".active").length==1){dropdown.addClass("active")}else{dropdown.removeClass("active")}}else{dropdown.addClass("hide")}$("#tabs_dropdown").outerClick(function(){$(this).removeClass("open")})}})},setDefaults:function(settings){$.extend($.fn.tabs.defaults,settings)},getDefaults:function(settings){return $.fn.tabs.defaults}};$.fn.tabs=function(option){var args=$.grep(arguments||[],function(n,i){return i>=1});var selector=$(this).selector||options.selector;return this.each(function(){var $this=$(this);var data=$this.data("bootui.tabs");if(!data&&option=="destroy"){return}if(!data){var options=$.extend(true,{"selector":selector},$.fn.tabs.defaults,$this.data(),((typeof option=="object"&&option)?option:{}));$this.data("bootui.tabs",(data=new $.bootui.widget.Tabs(this,options)))}if(typeof option=="string"){data[option].apply(data,[].concat(args||[]))}})};$.fn.tabs.defaults={version:"1.0.0",prefix:"tabs",beforeRender:$.noop,errorRender:$.noop,afterRender:$.noop,content:"",closeable:true,sortable:true,monitor:"body",obj:$(this),iframeUse:true,contextmenu:false,iframeHeight:function(){return $(window).height()-91},method:"init",callback:$.noop,clickEventType:((document.ontouchstart!==null)?"click":"touchstart")};$.fn.tabs.Constructor=$.bootui.widget.Tabs}(jQuery));