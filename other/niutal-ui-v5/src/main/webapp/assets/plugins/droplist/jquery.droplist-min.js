(function(a){a.bootui=a.bootui||{};a.bootui.widget=a.bootui.widget||{};a.bootui.widget.DropList=function(c,b){b.beforeRender.call(this,c);try{this.initialize.call(this,c,b)}catch(d){b.errorRender.call(this,d)}b.afterRender.call(this,c)};a.bootui.widget.DropList.prototype={constructor:a.bootui.widget.DropList,initialize:function(c,f){var g=this;g.loadAll=false;g.prevLetter="";g.counts={};g.allCount=0;var j=true,l=false;var m=a.founded(f.rangeSelector)?a(f.rangeSelector):c;if(f.mapper){f.mapper.pinyin=f.mapper.pinyin||"pinyin"}function t(w,v,i){if(/\W/.test(w)){w="-"}if(!isNaN(w)){w="_"}v.addClass("ln-"+w);if(g.counts[w]===undefined){g.counts[w]=0}g.counts[w]+=1;if(!i){g.allCount+=1}}function u(i){if(a(i).hasClass("all")){return g.allCount}else{var v=g.counts[a(i).attr("class").split(" ")[0]];return(v!==undefined)?v:0}}function p(){g.counts={};g.allCount=0;var y,x,i,w="",v=a.founded(f.filterSelector);g.$list.each(function(z,A){i=a(A);if(!v){y=a.trim(i.text()).toLowerCase()}else{y=a.trim(i.find(f.filterSelector).text()).toLowerCase()}if(y!==""){w=y.charAt(0);t.call(g,w,i)}});g.counts.matched=f.items.length;a.each(f.letters,function(z,B){var A=g.counts[B];if(!(a.founded(A))||(a.founded(A)&&Number(A)==0)){a("."+f.letters[z],g.$letters).addClass("ln-disabled")}else{a("."+f.letters[z],g.$letters).removeClass("ln-disabled")}})}function s(){var i=f.items.length;g.counts.matched=i;if(Number(i)==0){a("li.matched",g.$letters).addClass("ln-disabled")}else{a("li.matched",g.$letters).removeClass("ln-disabled")}}function h(v,A){if(!a.founded(v[A.key])){return null}var y=(f.index||"")+"_"+v[A.key];var i=v[A.pinyin];var w=v[A.key];var z=v[A.text];var x=v.checked||false;return a.extend({},v,{index:y,pinyin:i,checked:x,key:w,text:z})}function k(y,i,v){var w=false;a(y).find("label").off(f.clickEventType).on(f.clickEventType,function(z){z.preventDefault()});function x(C){C.stopPropagation();var B=a(this).find(":checkbox:eq(0)");if(!B.prop("disabled")){var A=a(this).data("table");var z=g.$list.filter("li[index="+i.index+"]");if(B.prop("checked")){B.prop("checked",false);B.next("span").removeClass("highlight");a(y).removeClass("checked");a(z).find(":checkbox:gt(0)").prop("checked",false);a(z).find(".highlight").removeClass("highlight");i[A]=[];g.removeCheckedItem(i)}else{B.prop("checked",true);B.next("span").addClass("highlight");a(z).find(":checkbox:gt(0)").prop("checked",true);a(z).find(":checkbox:gt(0)").next("span").addClass("highlight");a(y).addClass("checked");i[A]=[];a(z).find(":checkbox:gt(0)").each(function(){var E=a(this).val(),D=a(this).attr("text");i[A].push({key:E,text:D})});g.addCheckedItem(i)}p();f.onSelectItem.call(a(this),i,B.checked)}}a(y).find("th:eq(0)").off(f.clickEventType).on(f.clickEventType,function(z){x.call(this,z)});if(a(y).find("th").size()==0&&a(y).find("td").size()==1){a(y).find("td:eq(0)").off(f.clickEventType).on(f.clickEventType,function(z){x.call(this,z)})}a(y).find(":checkbox:eq(0)").off(f.clickEventType).on(f.clickEventType,function(C){C.stopPropagation();if(!a(this).prop("disabled")){var B=a(this).data("table");var A=a(this).prop("checked");var z=g.$list.filter("li[index="+i.index+"]");if(a(this).prop("checked")){a(this).next("span").addClass("highlight");a(z).find(":checkbox:gt(0)").prop("checked",true);a(z).find("label:gt(0)").each(function(){a(this).find("span").addClass("highlight")});a(y).addClass("checked");i[B]=[];a(z).find(":checkbox:gt(0)").each(function(){var E=a(this).val(),D=a(this).attr("text");i[B].push({key:E,text:D})});g.addCheckedItem(i)}else{a(this).next("span").removeClass("highlight");a(y).removeClass("checked");a(z).find(":checkbox:gt(0)").prop("checked",false);a(z).find(".highlight").removeClass("highlight");i[B]=[];g.removeCheckedItem(i)}p();f.onSelectItem.call(a(this),i,A)}});a(y).find("label:gt(0)").off(f.clickEventType).on(f.clickEventType,function(F){F.stopPropagation();var E=a(this).find(":checkbox:eq(0)");if(!a(E).prop("disabled")){var D=a(E).data("table");var C=a(E).prop("checked");var G=a(E).val(),z=a(E).attr("text"),B=a(this).parent().index();var A=g.$list.filter("li[index="+i.index+"]");if(a(E).prop("checked")){a(y).find(":checkbox:eq(0)").prop("checked",true);a(A).find(":checkbox:eq(0)").next("span").addClass("highlight");a(E).next("span").addClass("highlight");if(!a.founded(i[D])){i[D]=[];i[D][B]={key:G,text:z}}else{i[D].splice(B,0,{key:G,text:z})}if(!a(y).hasClass("checked")){a(y).addClass("checked");g.addCheckedItem(i)}}else{a(E).next("span").removeClass("highlight");a.each(i[D]||[],function(H,I){if(a.founded(I)&&G==I.key){i[D].splice(H,1)}})}p();f.onSelectItem.call(a(this),i,C)}});a(y).find(":checkbox:gt(0)").off(f.clickEventType).on(f.clickEventType,function(E){E.stopPropagation();if(!a(this).prop("disabled")){var D=a(this).data("table");var C=a(this).prop("checked");var F=a(this).val(),z=a(this).attr("text"),B=a(this).parent().index();var A=g.$list.filter("li[index="+i.index+"]");if(a(this).prop("checked")){a(y).find(":checkbox:eq(0)").prop("checked",true);a(A).find(":checkbox:eq(0)").next("span").addClass("highlight");a(this).next("span").addClass("highlight");if(!a.founded(i[D])){i[D]=[];i[D][B]={key:F,text:z}}else{i[D].splice(B,0,{key:F,text:z})}if(!a(y).hasClass("checked")){a(y).addClass("checked");g.addCheckedItem(i)}}else{a(this).next("span").removeClass("highlight");a.each(i[D]||[],function(G,H){if(a.founded(H)&&F==H.key){i[D].splice(G,1)}})}p();f.onSelectItem.call(a(this),i,C)}})}function e(z,x){var y=(a.founded(f.formatter)&&a.isFunction(f.formatter))?f.formatter:function(F,G,K){var C=this,i=K.mapper;var E=G.pinyin,I=G.key,J=G.text,B=i.zddm,L=i.table;var D=[];var H="";if(G.checked==true||g.hasCheckedItem(G)){H=' checked="checked" '}D.push('<p class="selector-name">'+E+"</p>");D.push("<table><tr>");D.push("<td valign='middle' "+(a.founded(f.tdClass)?" class='"+f.tdClass+"'":"")+">");D.push("<label class='inline'><input data-table='"+(L||"")+"'  name='"+i.key+"' value='"+I+"' text='"+J+"' type='checkbox' "+H+"/>&nbsp;");if(G.checked==true||g.hasCheckedItem(G)){D.push('<span class="highlight">')}else{D.push("<span>")}D.push(J+"</span></label></td>");D.push("</tr></table>");return D.join("")};var w=[];var A=((x.type==1)?' index="'+x.index+'" ':"");var v=[];a.each(x.parents||[],function(B,D){var C=D.key;if(a.founded(x.attrs[C])){v.push(" data-"+C+'="'+x.attrs[C]+'" ')}});v.push(' data-table="'+(f.mapper.table||"")+'" ');w.push("<li "+v.join(" ")+A+(a.founded(f.itemClass)?(" class='"+f.itemClass+"'"):"")+">");w.push(y.call(g,z,x,f));w.push("</li>");return w.join("")}function b(i){if(a.founded(i.href)&&a.founded(i.mapper)&&i.beforeRequest.call(g,g.letter)){a(m).empty().html(i.loadingHtml);a.ajaxSetup({async:false});var v=a.extend({},i.postData||{},{letter_text:i.mapper.text});a.post(i.href,v,function(x){a(m).empty();i.data=x;if(a.founded(x)){var w=[];w.push('<ul class="item-droplist">');a.each(x,function(z,y){var A=h(y,i.mapper);if(a.founded(A)){A.type=1;w.push(e.call(g,z,A))}});w.push("</ul>");w.push('<ul class="matched-droplist"></ul>');a(m).append(w.join(""))}a(m).append('<div class="ln-no-match hide">'+i.noMatchText+"</div>");if(a(m).find("ul.item-droplist li").size()==0){a(m).find(".ln-no-match").removeClass("hide").addClass("show")}g.$list=a(m).find("ul.item-droplist li");a(m).find("ul.item-droplist li").each(function(y,z){a(z).css(i.mapper.style||{});var A=h(x[y],i.mapper);if(a.founded(A)){k.call(g,z,A,1)}});g.$list.addClass("hide").removeClass("show");p();i.afterRequest.call(g,x,g.letter)},"json");a.ajaxSetup({async:true})}}a.extend(true,g,{removeCheckedItem:function(i){a.each(f.items||[],function(w,v){if(i.index==v.index){i.checked=false;f.items.splice(w,1);s();return false}})},addCheckedItem:function(i){if(!g.hasCheckedItem(i)){i.checked=true;f.items.push(i);s()}},hasCheckedItem:function(i){var v=false;a.each(f.items||[],function(w,x){if(x.index==i.index){v=true;return false}else{v=false}});return v},setOptions:function(i){a.each(i||{},function(v,w){delete f[v]});a.extend(f,i||{})},reload:function(i,v){g.setOptions(v||{});g.reloadData=true;a.each(i||{},function(x,w){delete f.postData[x]});a.extend(f.postData,i||{});a("."+g.letter,g.$letters).trigger(f.clickEventType)},resetSelection:function(i){a.each(f.data,function(x,w){var y=h(w,f.mapper);if(a.founded(y)){if(a.founded(i)&&y.key==i){g.removeCheckedItem(y);var v=g.$list.filter("li[index="+y.index+"]");a(v).find(":checkbox:eq(0)")[0].checked=false;a(v).find("span").removeClass("highlight");return false}else{g.removeCheckedItem(y);var v=g.$list.filter("li[index="+y.index+"]");a(v).find(":checkbox:eq(0)")[0].checked=false;a(v).find("span").removeClass("highlight")}}})},setSelection:function(i){a.each(f.data,function(x,w){var y=h(w,f.mapper);if(a.founded(y)&&y.key==i){g.addCheckedItem(y);var v=g.$list.filter("li[index="+y.index+"]");a(v).find(":checkbox:eq(0)")[0].checked=true;a(v).find("span").addClass("highlight");return false}})},getChecked:function(){return f.items}});if(!a(m).hasClass("droplist-content")){a(m).addClass("droplist-content")}a(m).prev("div.droplist").remove();a(m).find(".ln-no-match").remove();if(a.cookie&&(f.cookieName!==null)){var o=a.cookie(f.cookieName);if(o!==null){f.initLetter=o}}a(m).before('<div class="droplist"/>');a(m).append('<div class="ln-no-match hide">'+f.noMatchText+"</div>");var r=a(m).prev(".droplist");var d=new Array();d.push('<div class="ln-letters"><ul>');for(var q=1;q<f.letters.length;q++){if(q===1){d.push('<li class="all" href="#">'+f.allText+'</li><li class="_" href="#">0-9</li>')}var n=((f.letters[q]==="-")?f.otherText:((f.letters[q]==="matched")?f.matchText:f.letters[q].toUpperCase()));d.push('<li class="'+f.letters[q]+'" href="#">'+n+"</li>")}d.push("</ul></div>"+((f.showCounts)?'<div class="ln-letter-count hide">0</div>':""));r.empty().append(d.join(""));g.$letters=a(".ln-letters",r).slice(0,1);if(f.showCounts){g.$letterCount=a(".ln-letter-count",r).slice(0,1)}if(!f.includeAll){a(".all",g.$letters).remove()}if(!f.includeNums){a("._",g.$letters).remove()}if(!f.includeOther){a(".-",g.$letters).remove()}if(!f.incudeMatch){a(".matched",g.$letters).remove()}a(":last",g.$letters).addClass("ln-last");a(m).show();if(a.founded(f.href)&&a.founded(f.mapper)){}else{g.$list=a(m).find("ul.item-droplist li");p()}a("li",g.$letters).off(f.clickEventType).on(f.clickEventType,function(z){z.preventDefault();var w=a(this),A=a(m).find(".ln-no-match");g.letter=w.attr("class").split(" ")[0];if(a.founded(f.href)&&a.founded(f.mapper)){if((g.loadAll==false&&g.letter!="matched"&&g.letter!="-")||g.reloadData==true){f.postData.letter=g.letter;if(f.ajaxAtOnce==true){b.call(g,f);g.reloadData=false;if(g.letter==="all"){g.loadAll=true}}else{g.$list=a(m).find("ul.item-droplist li");p()}}}var x=g.$list.filter(".ln-"+g.prevLetter);var B=g.$list.filter(".ln-"+g.letter);var v=a(m).find("ul.item-droplist");var i=a(m).find("ul.matched-droplist");function C(D){a(v).hide();if(f.items.length==0){A.addClass("show").removeClass("hide")}else{A.addClass("hide").removeClass("show");a(i).empty();a.each(f.items||[],function(G,F){F.checked=true;F.type=2;var E=e.call(g,G,F);a(i).append(E);a(E).addClass("show").removeClass("hide")});a(m).find("ul.matched-droplist li").each(function(E,F){a(F).css(f.mapper.style||{})});a(i).show()}}if(g.prevLetter!==g.letter){a("li.ln-selected",g.$letters).removeClass("ln-selected");g.$list.addClass("hide").removeClass("show");a(i).hide();a(i).empty();if(g.letter==="all"){g.loadAll=true;g.$list.addClass("show").removeClass("hide");A.addClass("hide").removeClass("show");j=true;a(v).show()}else{if(g.letter==="matched"){C(z)}else{if(j){g.$list.addClass("hide").removeClass("show");j=false}else{if(g.prevLetter!==""){g.$list.filter(".ln-"+g.prevLetter).addClass("hide").removeClass("show")}}g.$list.filter(".ln-"+g.letter).addClass("show").removeClass("hide");var y=u(this);if(y>0){A.addClass("hide").removeClass("show")}else{A.addClass("show").removeClass("hide")}a(v).show()}}g.prevLetter=g.letter;if(a.cookie&&(f.cookieName!==null)){a.cookie(f.cookieName,g.letter,{expires:999})}w.addClass("ln-selected");w.blur()}else{if(g.letter==="all"){g.loadAll=true;g.$list.addClass("show").removeClass("hide");A.addClass("hide").removeClass("show");j=true}else{if(g.letter==="matched"){C(z)}else{if(j){g.$list.addClass("hide").removeClass("show");j=false}else{if(g.prevLetter!==""){g.$list.filter(".ln-"+g.prevLetter).addClass("hide").removeClass("show")}}g.$list.filter(".ln-"+g.letter).addClass("show").removeClass("hide");var y=u(this);if(y>0){A.addClass("hide").removeClass("show")}else{A.addClass("show").removeClass("hide")}}}}if(a.founded(f.onLetterClick)){f.onLetterClick.call(g,g.letter)}l=false});if(f.includeAll){}if(f.initLetter!==""){l=true;a("."+f.initLetter.toLowerCase(),g.$letters).slice(0,1).trigger(f.clickEventType)}else{if(f.includeAll){a(".all",g.$letters).addClass("ln-selected");if(a.founded(f.href)&&a.founded(f.mapper)){g.loadAll=true;f.postData.letter="";b.call(g,f)}}else{for(var q=((f.includeNums)?0:1);q<f.letters.length;q+=1){if(a.founded(f.href)&&a.founded(f.mapper)){l=true;a("."+f.letters[q],g.$letters).slice(0,1).trigger(f.clickEventType);break}else{if(g.counts[f.letters[q]]>0){l=true;a("."+f.letters[q],g.$letters).slice(0,1).trigger(f.clickEventType);break}}}}}if(f.showCounts){r.mouseover(function(){var i=g.$letterCount.outerHeight();g.$letterCount.css({top:a("li:first",r).slice(0,1).position().top-i})});a(".ln-letters li",r).unbind("mouseover").mouseover(function(y){var z=a(this);var x=a(this).position().left,i=(a(this).outerWidth())+"px",w=z.attr("class").split(" ")[0];var v=u(this);g.$letterCount.css({left:x,width:i}).text(v).addClass("show").removeClass("hide")}).unbind("mouseout").mouseout(function(){g.$letterCount.addClass("hide").removeClass("show")})}},setDefaults:function(b){a.extend(a.fn.droplist.defaults,b)}};a.fn.droplist=function(d){var b=a(this).selector;var c=a.grep(arguments||[],function(f,e){return e>=1});return this.each(function(){var g=a(this),f=g.data("droplist");if(!f&&d=="destroy"){return}if(!f){var e=a.extend(true,{},a.fn.droplist.defaults,g.data(),((typeof d=="object"&&d)?d:{}),{selector:b});g.data("droplist",(f=new a.bootui.widget.DropList(this,e)))}if(typeof d=="string"){f[d].apply(f,[].concat(c||[]))}})};a.fn.droplist.defaults={version:"1.0.0",beforeRender:a.noop,errorRender:a.noop,afterRender:a.noop,beforeRequest:function(b){return true},afterRequest:function(c,b){},onLetterClick:function(b){},onSelectItem:function(c,b){},rangeSelector:null,href:"",postData:{},switches:{},onDataRangeSync:function(){},mapper:null,formatter:null,itemClass:"",loadingHtml:'<p class="text-center header smaller lighter loading"><i class="icon-spinner icon-spin orange  bigger-300"></i></br> \u6570\u636e\u6b63\u5728\u8f7d\u5165\u6570\u636e\u4e2d....</p>',index:"droplist",ajaxAtOnce:true,includeAll:true,allText:"\u5168\u90e8",includeNums:true,incudeOther:false,otherText:"\u5176\u4ed6",incudeMatch:true,matchText:"\u5df2\u9009",initLetter:"all",filterSelector:".selector-name",noMatchText:"\u6ca1\u6709\u6570\u636e...",showCounts:true,cookieName:null,letters:["_","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","-","matched"],firstClick:false,items:[],clickEventType:((document.ontouchstart!==null)?"click":"touchstart")};a.fn.droplist.Constructor=a.bootui.widget.DropList}(jQuery));
