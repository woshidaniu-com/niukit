(function(b){b.bootui=b.bootui||{};b.bootui.widget=b.bootui.widget||{};b.bootui.widget.Typeahead=function(d,c){c.beforeRender.call(this,d);try{this.initialize.call(this,d,c)}catch(f){c.errorRender.call(this,f)}c.afterRender.call(this,d)};b.bootui.widget.Typeahead.prototype={constructor:b.bootui.widget.Typeahead,initialize:function(d,c){var e=this;this.$element=b(d);this.options=c;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.updater=this.options.updater||this.updater;this.source=this.options.source;this.$menu=b(this.options.menu);this.shown=false;this.formatItem=this.options.formatItem||this.formatItem;this.setValue=this.options.setValue||this.setValue;this.$element.on("focus",b.proxy(this.focus,this)).on("blur",b.proxy(this.blur,this)).on("keypress",b.proxy(this.keypress,this)).on("keyup",b.proxy(this.keyup,this));if(this.eventSupported("keydown")){this.$element.on("keydown",b.proxy(this.keydown,this))}this.$menu.css({"min-width":b(d).outerWidth()}).on("click",b.proxy(this.click,this)).on("mouseenter","li",b.proxy(this.mouseenter,this)).on("mouseleave","li",b.proxy(this.mouseleave,this))},destroy:function(){this.$element.off(".typeahead").removeData("bootui.typeahead")},setDefaults:function(c){b.extend(b.fn.typeahead.defaults,c)},processObj:0,formatItem:function(c){return c.toString()},setValue:function(c){return{"data-value":c.toString(),"real-value":c.toString()}},select:function(){var d=this.$menu.find(".active").attr("data-value");var c=this.$menu.find(".active").attr("real-value");this.$element.val(this.updater(d)).attr("real-value",c).change();return this.hide()},updater:function(c){return c},show:function(){var e=b.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});this.$menu.insertAfter(this.$element);var d=this.$element.closest(".bootbox");var c=1010;if(b(d).size()>0){c=(parseInt(d.css("z-index")||"1050")+90);this.$menu.css({"z-index":c,top:e.top+e.height,left:e.left}).show();b(d).find(".chosen-container").css("z-index",--c)}else{this.$menu.css({"z-index":"1010",top:e.top+e.height,left:e.left}).show();this.$element.css("z-index","1010");b(".chosen-container").css("z-index",--c)}this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this},lookup:function(d){var c;this.query=this.$element.val();if(!this.query||this.query.length<this.options.minLength){return this.shown?this.hide():this}c=b.isFunction(this.source)?this.source(this.query,b.proxy(this.process,this)):this.source;return c?this.process(c):this},process:function(c){var d=this;if(!c.length){return this.shown?this.hide():this}return this.render(c.slice(0,this.options.items)).show()},highlighter:function(d){var c=this;d=c.formatItem(d);var e=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return d.replace(new RegExp("("+e+")","ig"),function(f,g){return'<strong style="color:#FF6600;">'+g+"</strong>"})},render:function(c){var d=this;c=b(c).map(function(e,f){e=b(d.options.item).attr(d.setValue(f));e.find("a").html(d.highlighter(f));return e[0]});c.first().addClass("active");this.$menu.html(c);return this},next:function(d){var e=this.$menu.find(".active").removeClass("active"),c=e.next();if(!c.length){c=b(this.$menu.find("li")[0])}c.addClass("active")},prev:function(d){var e=this.$menu.find(".active").removeClass("active"),c=e.prev();if(!c.length){c=this.$menu.find("li").last()}c.addClass("active")},eventSupported:function(c){var d=c in this.$element;if(!d){this.$element.setAttribute(c,"return;");d=typeof this.$element[c]==="function"}return d},move:function(c){if(!this.shown){return}switch(c.keyCode){case 9:case 13:case 27:c.preventDefault();break;case 38:c.preventDefault();this.prev();break;case 40:c.preventDefault();this.next();break}c.stopPropagation()},keydown:function(c){this.suppressKeyPressRepeat=~b.inArray(c.keyCode,[40,38,9,13,27]);this.move(c)},keypress:function(c){if(this.suppressKeyPressRepeat){return}this.move(c)},keyup:function(d){switch(d.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown){return}this.select();break;case 27:if(!this.shown){return}this.hide();break;default:var c=this;if(c.processObj){clearTimeout(c.processObj);c.processObj=0}c.processObj=setTimeout(function(){c.lookup()},c.options.delay)}d.stopPropagation();d.preventDefault()},focus:function(c){this.focused=true},blur:function(c){this.focused=false;if(!this.mousedover&&this.shown){this.hide()}},click:function(c){c.stopPropagation();c.preventDefault();this.select();this.$element.focus()},mouseenter:function(c){this.mousedover=true;this.$menu.find(".active").removeClass("active");b(c.currentTarget).addClass("active")},mouseleave:function(c){this.mousedover=false;if(!this.focused&&this.shown){this.hide()}}};var a=b.fn.typeahead;b.fn.typeahead=function(d){var c=b.grep(arguments||[],function(f,e){return e>=1});return this.each(function(){var g=b(this),f=g.data("bootui.typeahead");if(!f&&d=="destroy"){return}if(!f){var e=b.extend(true,{},b.fn.typeahead.defaults,g.data(),((typeof d=="object"&&d)?d:{}));g.data("bootui.typeahead",(f=new b.bootui.widget.Typeahead(this,e)))}if(typeof d=="string"){f[d].apply(f,[].concat(c||[]))}})};b.fn.typeahead.defaults={version:"1.0.0",beforeRender:b.noop,errorRender:b.noop,afterRender:b.noop,source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1,delay:500};b.fn.typeahead.Constructor=b.bootui.widget.Typeahead;b.fn.typeahead.noConflict=function(){b.fn.typeahead=a;return this};b(document).on("focus.typeahead.data-api",'[data-provide*="typeahead"]',function(c){if(c.currentTarget=this){var d=b(this);if(d.data("bootui.typeahead")){return}else{d.typeahead(d.data())}}})}(jQuery));
