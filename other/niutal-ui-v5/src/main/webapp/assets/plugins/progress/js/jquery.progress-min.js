(function(b){b.oldAjax=b.ajax;var a=["progress-bar-info","progress-bar-success","progress-bar-warning","progress-bar-danger"];b.fn.progress=function(c){b.extend(c||{},{beforeLookup:c.beforeLookup||b.noop,progressURL:c.progressURL,progressDelay:c.progressDelay||3000,progressPeriod:c.progressPeriod||400,progressComplete:c.progressComplete||b.noop});return b(this).each(function(){var d=b(this);var g=d.data("finished")||false;if(g==true){var f=function(){var h=d.data("errored")||false;var i=d.data("successed")||false;if(i==true){if(!d.hasClass("progress-bar-success")){d.removeClass(a.join(" ")).addClass("progress-bar-success")}d.css("width","100%").text("100%").attr("aria-valuenow",100);window.setTimeout(function(){d.closest(".progress").hide();d.css("width","0%").text("0%").attr("aria-valuenow",0).removeClass(a.join(" "))},c.progressDelay)}else{if(h==true){d.removeClass(a.join(" ")).addClass("progress-bar-danger")}}};var e=d.data("def");if(e){b.when(e).done(f)}else{f.call(this)}}else{b.ajax({type:"POST",url:c.progressURL,async:true,dataType:"json",success:function(i){i=parseFloat(i);if(c.beforeLookup.call(this,i,g)){if(i>=0){var h=d.closest(".progress");if(h.is(":hidden")){h.show()}i=Math.min(i,100);d.css("width",i+"%").text(i+"%").attr("aria-valuenow",i)}if(i>=90&&!d.hasClass("progress-bar-success")){d.removeClass(a.join(" ")).addClass("progress-bar-success")}if(i>=100){d.data("finished",true)}window.setTimeout(function(){b(d).progress(c)},c.progressPeriod)}else{if(g==true){window.setTimeout(function(){d.closest(".progress").hide();d.css("width","0%").text("0%").attr("aria-valuenow",0).removeClass(a.join(" "))},c.progressDelay)}}c.progressComplete.call(this,i)}})}})};b.fn.progress.reset=function(c){return b(this).progress(b.extend({},c,{beforeLookup:function(d,e){return d>0&&e!=true}}))};jQuery.ajax=jQuery.wrapAjax=function(e){if(!(jQuery.type(e)==="string")&&b.founded(e.progressElement)&&b(e.progressElement).size()>0){b.extend(e||{},{progressElement:e.progressElement,progressURL:e.progressURL,progressDelay:e.progressDelay||3000,progressPeriod:e.progressPeriod||400,beforeLookup:e.beforeLookup||b.noop,progressComplete:e.progressComplete||b.noop});var c=b.extend({},{beforeSend:e.beforeSend||b.noop,success:e.success||b.noop,error:e.error||b.noop,complete:e.complete||b.noop});var d=b(e.progressElement);var g=b(d).size()==1&&!b.founded(e.progressURL);var f=b(d).size()==1&&b.founded(e.progressURL);if(g||f){d.removeClass(a.join(" ")).addClass("progress-bar-info");d.closest(".progress").show();d.removeData("successed");d.removeData("errored");d.removeData("finished")}if(g==true){d.closest(".progress").fadeIn("fast",function(){d.css("width","40%").text("40%").attr("aria-valuenow",40)})}b.Deferred(function(h){d.data("def",h)}).promise();return b.oldAjax(b.extend(e,{beforeSend:function(i,h){d.closest(".progress").fadeIn("fast",function(){if(g==true){d.css("width","70%").text("70%").attr("aria-valuenow",70)}else{if(f==true){b(d).css("width","0%").text("0%").attr("aria-valuenow",0);var j=0;b(e.progressElement).progress(b.extend({},e,{beforeLookup:function(k,l){if(k==-1&&j<=10){j+=1;return true}return k>=0&&l!=true}}))}}});return c.beforeSend.call(this,i,h)},success:function(h,j,k){if(g==true){d.css("width","90%").text("90%").attr("aria-valuenow",90).removeClass(a.join(" ")).addClass("progress-bar-success")}else{if(f==true){if(b.type(h)==="string"){if(h.indexOf("\u6210\u529f")>-1){d.data("successed",true)}else{if(h.indexOf("\u5931\u8d25")>-1){d.data("errored",true)}}}else{if(b.isPlainObject(h)){if(h.status=="success"){d.data("successed",true)}else{if(h.status=="error"){d.data("errored",true)}}}}}}var i=d.data("def");if(i){i.resolve()}c.success.call(this,h,j,k)},error:function(j,i,h){if(g==true){d.removeClass(a.join(" ")).addClass("progress-bar-danger")}else{if(f==true){d.data("errored",true)}}c.error.call(this,j,i,h)},complete:function(i,h){if(h=="success"&&g==true){d.css("width","100%").text("100%").attr("aria-valuenow",100);window.setTimeout(function(){d.closest(".progress").hide();d.css("width","0%").text("0%").attr("aria-valuenow",0).removeClass(a.join(" "))},e.progressDelay)}d.data("finished",true);c.complete.call(this,i,h)}}))}else{return b.oldAjax(e)}};b.each(["get","post"],function(c,d){b[d]=function(f,h,i,g,e){if(b.isFunction(h)){g=g||i;i=h;h=undefined}if(b.defined(e)==true&&!(b.type(e)==="string")&&b.founded(e.progressElement)==true&&b(e.progressElement).size()>0){return b.ajax(b.extend({url:f,type:d,dataType:g,data:h,success:i},e))}else{return b.oldAjax({url:f,type:d,dataType:g,data:h,success:i})}}})})(jQuery);
